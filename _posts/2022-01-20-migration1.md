---
title: Migration from AWS to GCP
tag : [nw]
author: hayley
---

<font size="5" color="purple"><b>Migration from AWS to GCP</b></font>
<p> GCP 스킬업을 위해 기존 AWS에 올라간 솔루션을 GCP로 migration할 기회가 생겼다. 
<p> 다양한 GCP Resource를 활용해서 기존 구성을 변경하여 migration을 시도해볼 수 있고 
<p> 개발자/운영자의 입장을 고려한 단계적 migration을 시도해보면서 GCP와 같은 Public cloud 를 익히는데도 도움이 될 수 있겠다싶었다.
<br>
<br>  
<p><b>1.기존 구성안 검토</b> 
<p>- 우선 기존에 AWS에 어떻게 구성되었는지 살펴봤다. 
<p>  서버, DB, Storage 등 간단한 웹서버 구성이었다. 
<p>  초기요구사항은 기존의 트래픽 사용량 대비 비용절감을 원하셨지만 
<p>  개인적인 바람은 서비스가 잘되서 트래픽을 감당할 수 없는 상황에도 안정적인 인프라를 지원하는 것이었다. 
<p>  현재 상황을 만족한 설계라면 기존 구성을 copy and paste하는 방식으로 그대로 migration할 수 있지만 
<p>  나중을 위해선 유동적인 트래픽 상황에 대응하여 autoscaling, 장애상황에 대한 failover를 위한 HA를 고려하지않을 수 없었다.
<p>
<p><b>기존 구성의 문제점</b>
<p>- 보통 개발환경은 local, dev, integration, qa, staging, production 단계로 나뉜다   
<p>  개발자분들의 얘기를 들으니 현재 local환경에서 개발을 하시고 클라우드 서버에 원격접속하신다고 했다. 
<p>  프로젝트 환경에 따라 단계가 다르지만 간단히 각 단계를 살펴보면, 
<p>  
<p>  * local(로컬 개발 환경) : 개발자 PC에 각자 개발 및 테스트 환경이 셋업된 상태이다. 모든 개발자가 같은 개발 환경을 사용해야한다는 것이 문제다.
<p>           다른 버전의 JVM 등을 사용해서 코드를 합칠 때 local에서 작동한 코드가 작동하지 않을 수 있다. 
<p>           개발 환경을 표준화하는 방법이 있지만 전체 개발 환경을 zip 파일 형태로 묶어서 사용하는 방법이 일반적이다. 
<p>           maven 등을 사용하면 개발에 사용되는 JDK, 라이브러리 버전 등을 지정할 수 있어 개발 환경 차이에서 오는 문제점의 상당 부분을 해소할 수 있다.    
<p>
<p>  * dev(서버 개발 환경) : 각 개별 개발자들이 만든 코드를 합쳐서 서버 환경에서 테스트해볼 수 있는 환경이다. 소스코드를 git과 같은 형상관리 시스템에서 commit하면
<p>                    코드는 dev 개발 환경에 자동으로 배포되고 이 환경에서 테스트가 된다. 기능 개발을 위주로 하여 production 환경보다 훨씬 작게 
<p>                    dev 개발 환경은 한 두개의 서버로 기능 구현이 가능한 정도로 구축하는 것이 일반적이다.   
<p>
<p>  * integration(통합 개발 환경) : 여러 개의 컴포넌트를 동시 개발하는 프로젝트가 있고 각 컴포넌트가 다른 컴포넌트에 대해 dependency를 가지고 있을 때
<p>                                  컴포넌트를 통합 및 테스트하는 환경으로 사용한다.(단말과 서버를 같이 개발하는 경우 integration 환경에서 통합한다)
<p>                                  dev 환경과 마찬가지로 최소한의 set으로 구성하고 dev 환경에서 release 되면 주기적으로 deploy한다  
<p>
<p>  * qa(테스팅 환경) : QA 엔지니어에 의해 사용되는 환경으로 short release 주기에 따라 개발환경에서 QA 환경으로 배포되고 여기서 기능 및 비기능(load test) 등을 QA 엔지니어가 수행한다
<p>                      비기능 테스트를 수행할 때는 production과 거의 유사한 환경을 만들어 놓고 테스트를 수행한다.   
<p>  * staging(스테이징 환경) : 운영 환경과 거의 동일한 환경을 만들어 놓고 운영환경으로 이전하기 전에 여러 비 기능적인 부분(security, 성능, 장애 등)을 검증하는 환경이다.
<p>
<p>  * production(운영 환경) : 실제 서비스를 위한 운영 환경  
<p>
<p>  위와 같은 단계에서 현재 local, production 단계만 구성되어있어 실제 서비스를 테스트하기 전에 기능 테스트를 위한 단계가 필요해보였다.
<p><img src='https://cloud.google.com/docs/images/best-practices-for-enterprise-organizations.png'>  
<p style="text-align:center"><b>GCP resource hierarchy</b>  
<br> 
<br>
<br>
<br>      
<br> <font size="5" color="purple"><b>[Reference]
<p><a href="https://bcho.tistory.com/759">개발 환경(dev,stage,qa,production)
<p><a href="https://cloud.google.com/docs/enterprise/best-practices-for-enterprise-organizations">Best practices for enterprise organizations  
<p><a href="https://www.rabbitmq.com/">https://www.rabbitmq.com/
<p><a href="https://hanxiao.io/2019/01/02/Serving-Google-BERT-in-Production-using-Tensorflow-and-ZeroMQ/?fbclid=IwAR0iOSuhSaFqbNlnuDECE7KMLCEP-akGhTfEF8JJW4bzsGB5Q9Qjyb90Ov0">https://hanxiao.io/2019/01/02/Serving-Google-BERT-in-Production-using-Tensorflow-and-ZeroMQ/?fbclid=IwAR0iOSuhSaFqbNlnuDECE7KMLCEP-akGhTfEF8JJW4bzsGB5Q9Qjyb90Ov0 
<p><a href="https://soooprmx.com/using-multipart-data-on-pub-sub-pattern/">https://soooprmx.com/using-multipart-data-on-pub-sub-pattern/        
 


  
